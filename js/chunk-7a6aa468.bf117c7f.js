(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a6aa468"],{"0a6c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("邮件管理")])]),a("el-tabs",{attrs:{"tab-position":"left"},model:{value:e.actTab,callback:function(t){e.actTab=t},expression:"actTab"}},[a("el-tab-pane",{attrs:{name:"single",label:"邮件申请"}},[a("single-con",{on:{changeTabS:e.handleGetAct}})],1),a("el-tab-pane",{attrs:{name:"muiti",label:"批量发放申请"}},[a("multi-con",{on:{changeTabM:e.handleGetAct}})],1),a("el-tab-pane",{attrs:{name:"list",label:"审批/列表"}},[a("list-con",{attrs:{oriTab:e.actTab}})],1)],1)],1)},l=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.isRole()?a("el-button",{attrs:{disabled:e.aSelectRow.length<1},on:{click:function(t){return e.handlePassMulti("1")}}},[e._v("审核通过")]):e._e(),e.isRole()?a("el-button",{attrs:{disabled:e.aSelectRow.length<1},on:{click:function(t){return e.handlePassMulti("2")}}},[e._v("作废")]):e._e(),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.aTableDataEmail,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectRows}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"70"}}),a("el-table-column",{attrs:{prop:"time",label:"申请时间","min-width":"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"申请人","min-width":"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"reason",label:"申请原因","min-width":"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"status",label:"审批结果","min-width":"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("statusFilter")(t.row.status)))])]}}])}),a("el-table-column",{attrs:{prop:"approverName",label:"审批人","min-width":"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"操作","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.handleClickDetail(t.row)}}},[e._v("详情")])]}}])})],1),a("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next","current-page":e.objPager.currentPage,"page-size":e.objPager.pageSize,total:e.objPager.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.objPager,"currentPage",t)},"update:current-page":function(t){return e.$set(e.objPager,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.objPager,"pageSize",t)},"update:page-size":function(t){return e.$set(e.objPager,"pageSize",t)}}}),a("el-dialog",{attrs:{title:"邮件详情",visible:e.bDialogVisible},on:{"update:visible":function(t){e.bDialogVisible=t}}},[a("el-form",[a("el-form-item",{attrs:{label:"审批结果"}},[a("p",[e._v(e._s(e._f("statusFilter")(e.objFormEmailSingle.status)))])]),a("el-form-item",{attrs:{label:"服务器"}},[a("p",[e._v(e._s(e.returnServer(e.objFormEmailSingle.serverId)))])]),a("el-form-item",{attrs:{label:"收件人"}},[a("p",[e._v(e._s(e.objFormEmailSingle.receiverType))])]),e.objFormEmailSingle.receiverType&&"1"!==e.objFormEmailSingle.receiverType?a("el-form-item",{attrs:{label:"",prop:"params"}},[a("p",[e._v(e._s(e.objFormEmailSingle.params))])]):e._e(),a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("p",[e._v(e._s(e.objFormEmailSingle.title))])]),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("p",[e._v(e._s(e.objFormEmailSingle.content))])]),a("el-form-item",{attrs:{label:"开始发奖时间",prop:"startRewardTime"}},[a("p",[e._v(e._s(e.objFormEmailSingle.startRewardTime))])]),a("el-form-item",{attrs:{label:"结束发奖时间"}},[a("p",[e._v(e._s(e.objFormEmailSingle.endRewardTime))])]),a("el-form-item",{attrs:{label:"申请原因"}},[a("p",[e._v(e._s(e.objFormEmailSingle.reason))])]),a("el-form-item",{attrs:{label:"角色有效开始时间"}},[a("p",[e._v(e._s(e.objFormEmailSingle.effectiveStartingTime))])]),a("el-form-item",{attrs:{label:"角色有效结束时间"}},[a("p",[e._v(e._s(e.objFormEmailSingle.effectiveEndingTime))])]),a("el-form-item",{attrs:{label:"物品"}},e._l(e.objFormEmailSingle.items,(function(t,r){return a("p",{key:r},[e._v("【名称："+e._s(t.name)+"】-数量："+e._s(t.num))])})),0),0==e.objFormEmailSingle.status&&e.isRole()?a("el-form-item",{staticStyle:{textAlign:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleClickPass("objFormAnnoEdit")}}},[e._v("审批通过")])],1):e._e()],1)],1)],1)},o=[],n=(a("cc57"),a("6d57"),a("163d"),{name:"email-list",props:{oriTab:{type:String,default:"create"}},data:function(){return{bDialogVisible:!1,objFormEmailSingle:{},aTableDataEmail:[{id:"111",serverId:["111","222"],time:"111",name:"2019-09-19 09：32：12",reason:"原因",status:"0",approverName:"审批人",params:"角色名或者 角色id ",title:"邮件标题",content:"邮件内容",startRewardTime:"2019-09-19 09：32：12",endRewardTime:"2019-09-19 09：32：12",receiverType:"1",items:[{itemId:"234",num:234}],effectiveStartingTime:"2019-09-19 09：32：12",effectiveEndingTime:"2019-09-19 09：32：12"}],aSelectRow:[],objPager:{total:20,currentPage:1,pageSize:10}}},watch:{oriTab:{handler:function(){"list"==this.oriTab&&this.fetchEmailList()}}},filters:{statusFilter:function(e){var t=["未审批","通过","作废","已发放"];return t[Number(e)]}},methods:{isRole:function(){var e=JSON.parse(sessionStorage.getItem("userInfo")),t=e.powerType;return"超级管理员"==t},returnServer:function(e){if(e){var t=[];e.forEach((function(e){t.push(e.name)}));var a=t.join(",");return a}},handleSelectRows:function(e){this.aSelectRow=e},handlePassMulti:function(e){var t=this,a=this.aSelectRow.map((function(e){return e.id})),r={mailId:a,type:e};this.$fetch.post(API.email.approval_mail,r).then((function(e){var a=e.data;200==a.status?t.fetchEmailList():t.$message.error(a.desc)}))},handleClickDetail:function(e){this.objFormEmailSingle=e,this.bDialogVisible=!0},handleClickPass:function(){var e=this,t={mailId:[this.objFormEmailSingle.id],type:"1"};this.$fetch.post(API.email.approval_mail,t).then((function(t){var a=t.data;200==a.status?(e.bDialogVisible=!1,e.fetchEmailList()):e.$message.error(a.desc)}))},fetchEmailList:function(){var e=this,t={page:this.objPager.currentPage,pageSize:this.objPager.pageSize};this.$fetch.post(API.email.mail_list,t).then((function(t){var a=t.data;200==a.status?(e.aTableDataEmail=a.data.mails,e.objPager.total=a.data.total):e.$message.error(a.desc)}))},handlePageChange:function(e){this.objPager.currentPage=e,this.fetchEmailList()}},mounted:function(){this.fetchEmailList()}}),s=n,m=(a("f616"),a("4e82")),c=Object(m["a"])(s,i,o,!1,null,"6a03bae2",null),u=c.exports,d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"objFormEmailMulti",attrs:{model:e.objFormEmailMulti,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"订单流水号",prop:"sequenceId"}},[a("el-input",{attrs:{placeholder:"请输入订单流水号"},model:{value:e.objFormEmailMulti.sequenceId,callback:function(t){e.$set(e.objFormEmailMulti,"sequenceId",t)},expression:"objFormEmailMulti.sequenceId"}})],1),a("el-form-item",{attrs:{label:"批量发放文件"}},[a("el-upload",{attrs:{action:e.uploadUrl,"on-success":e.uploadSuccess,"on-error":e.uploadError,multiple:!1,accept:"csv",limit:1,"on-exceed":e.uploadExceed}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传excel文件，且不超过500kb")])],1)],1),a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入标题"},model:{value:e.objFormEmailMulti.title,callback:function(t){e.$set(e.objFormEmailMulti,"title",t)},expression:"objFormEmailMulti.title"}})],1),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.objFormEmailMulti.content,callback:function(t){e.$set(e.objFormEmailMulti,"content",t)},expression:"objFormEmailMulti.content"}})],1),a("el-form-item",{attrs:{label:"开始发奖时间",prop:"startRewardTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择开始发奖时间"},model:{value:e.objFormEmailMulti.startRewardTime,callback:function(t){e.$set(e.objFormEmailMulti,"startRewardTime",t)},expression:"objFormEmailMulti.startRewardTime"}})],1),a("el-form-item",{attrs:{label:"结束发奖时间",prop:"endRewardTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择结束发奖时间"},model:{value:e.objFormEmailMulti.endRewardTime,callback:function(t){e.$set(e.objFormEmailMulti,"endRewardTime",t)},expression:"objFormEmailMulti.endRewardTime"}})],1),a("el-form-item",{attrs:{label:"申请原因",prop:"reason"}},[a("el-input",{attrs:{placeholder:"请输入申请原因"},model:{value:e.objFormEmailMulti.reason,callback:function(t){e.$set(e.objFormEmailMulti,"reason",t)},expression:"objFormEmailMulti.reason"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFormMulti("objFormEmailMulti")}}},[e._v("申请发奖")])],1)],1)],1)},p=[],b=a("6e40"),f={name:"email-multi",data:function(){return{objFormEmailMulti:{sequenceId:"",fileId:null,title:"",content:"",startRewardTime:null,endRewardTime:null,reason:""},rules:{sequenceId:[{required:!0,message:"请输入标题",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],startRewardTime:[{required:!0,message:"请选择时间",trigger:"change"}],endRewardTime:[{required:!0,message:"请选择时间",trigger:"change"}],reason:[{required:!0,message:"请输入申请原因",trigger:"blur"}]}}},computed:{uploadUrl:function(){return b["a"]+API.upload}},methods:{submitFormMulti:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return!1;var r=JSON.parse(JSON.stringify(t.objFormEmailMulti));t.$fetch.post(API.email.add_mail_batch,r).then((function(a){var r=a.data;200==r.status?(t.$emit("changeTabM","list"),t.$refs[e].resetFields(),t.$message.success(r.desc)):t.$message.error(r.desc)}))}))},fetchServerList:function(){var e=this;this.$fetch.post(API.anno.server_list).then((function(t){var a=t.data;200==a.status?e.aServerList=a.data:e.$message.error(a.desc)}))},uploadSuccess:function(e,t,a){200==e.status?(this.objFormEmailMulti.fileId=e.data.fileId,this.$message.success(e.desc)):this.$message.error(e.desc)},uploadError:function(e,t,a){},uploadExceed:function(e,t){this.$message.error("文件上传数量超出上限！")}}},g=f,v=Object(m["a"])(g,d,p,!1,null,null,null),h=v.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"objFormEmailSingle",attrs:{model:e.objFormEmailSingle,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"服务器",prop:"serverId"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择服务器"},model:{value:e.objFormEmailSingle.serverId,callback:function(t){e.$set(e.objFormEmailSingle,"serverId",t)},expression:"objFormEmailSingle.serverId"}},e._l(e.aServerList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.serverId}})})),1)],1),a("el-form-item",{attrs:{label:"收件人"}},[a("el-radio-group",{attrs:{prop:"receiverType"},model:{value:e.objFormEmailSingle.receiverType,callback:function(t){e.$set(e.objFormEmailSingle,"receiverType",t)},expression:"objFormEmailSingle.receiverType"}},[a("el-radio",{attrs:{label:"1"}},[e._v("所有人")]),a("el-radio",{attrs:{label:"2",disabled:1!==e.objFormEmailSingle.serverId.length}},[e._v("角色ID")]),a("el-radio",{attrs:{label:"3",disabled:1!==e.objFormEmailSingle.serverId.length}},[e._v("角色名称")])],1)],1),e.objFormEmailSingle.receiverType&&"1"!==e.objFormEmailSingle.receiverType?a("el-form-item",{attrs:{label:"",prop:"params"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入收件人，请用，隔开！"},model:{value:e.objFormEmailSingle.params,callback:function(t){e.$set(e.objFormEmailSingle,"params",t)},expression:"objFormEmailSingle.params"}})],1):e._e(),a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入标题"},model:{value:e.objFormEmailSingle.title,callback:function(t){e.$set(e.objFormEmailSingle,"title",t)},expression:"objFormEmailSingle.title"}})],1),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.objFormEmailSingle.content,callback:function(t){e.$set(e.objFormEmailSingle,"content",t)},expression:"objFormEmailSingle.content"}})],1),a("el-form-item",{attrs:{label:"开始发奖时间",prop:"startRewardTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择开始发奖时间"},model:{value:e.objFormEmailSingle.startRewardTime,callback:function(t){e.$set(e.objFormEmailSingle,"startRewardTime",t)},expression:"objFormEmailSingle.startRewardTime"}})],1),a("el-form-item",{attrs:{label:"结束发奖时间",prop:"endRewardTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择结束发奖时间"},model:{value:e.objFormEmailSingle.endRewardTime,callback:function(t){e.$set(e.objFormEmailSingle,"endRewardTime",t)},expression:"objFormEmailSingle.endRewardTime"}})],1),a("el-form-item",{attrs:{label:"申请原因",prop:"reason"}},[a("el-input",{attrs:{placeholder:"请输入申请原因"},model:{value:e.objFormEmailSingle.reason,callback:function(t){e.$set(e.objFormEmailSingle,"reason",t)},expression:"objFormEmailSingle.reason"}})],1),a("el-form-item",{attrs:{label:"角色有效开始时间",prop:"effectiveStartingTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择角色有效开始时间"},model:{value:e.objFormEmailSingle.effectiveStartingTime,callback:function(t){e.$set(e.objFormEmailSingle,"effectiveStartingTime",t)},expression:"objFormEmailSingle.effectiveStartingTime"}})],1),a("el-form-item",{attrs:{label:"角色有效结束时间",prop:"effectiveEndingTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择角色有效结束时间"},model:{value:e.objFormEmailSingle.effectiveEndingTime,callback:function(t){e.$set(e.objFormEmailSingle,"effectiveEndingTime",t)},expression:"objFormEmailSingle.effectiveEndingTime"}})],1),a("el-form-item",{attrs:{label:"邮件奖励内容"}},[a("el-button",{on:{click:function(t){return t.preventDefault(),e.addItem(t)}}},[e._v("添加")])],1),e._l(e.objFormEmailSingle.items,(function(t,r){return a("el-row",{key:r,staticStyle:{marginTop:"10px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:1,offset:2}},[a("span",{staticStyle:{lineHeight:"40px"}},[e._v(e._s(r+1))])]),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"道具",prop:"items."+r+".itemId","label-width":"60px",rules:{required:!0,message:"道具不能为空",trigger:"blur"}}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择道具"},model:{value:t.itemId,callback:function(a){e.$set(t,"itemId",a)},expression:"item.itemId"}},e._l(e.aItemList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.type+"-"+e.name,value:e.itemId}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"数量",prop:"items."+r+".num","label-width":"60px",rules:{required:!0,message:"数量不能为空",trigger:"blur"}}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:t.num,callback:function(a){e.$set(t,"num",a)},expression:"item.num"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-button",{on:{click:function(a){return a.preventDefault(),e.removeItem(t)}}},[e._v("删除")])],1)],1)})),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("objFormEmailSingle")}}},[e._v("申请发奖")])],1)],2)],1)},S=[],j={name:"email-single",data:function(){var e=function(e,t,a){if(!t)return a(new Error("至少选择一个服务器"));a()};return{aItemList:[],aServerList:[],objFormEmailSingle:{serverId:"",receiverType:"1",params:"",title:"",content:"",startRewardTime:null,endRewardTime:null,reason:"",effectiveStartingTime:null,effectiveEndingTime:null,items:[{itemId:"",num:1}]},rules:{serverId:[{validator:e,required:!0,trigger:"change"}],receiverType:[{required:!0,message:"请选择收件人",trigger:"change"}],params:[{required:!0,message:"请输入id",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],startRewardTime:[{required:!0,message:"请选择时间",trigger:"change"}],endRewardTime:[{required:!0,message:"请选择时间",trigger:"change"}],reason:[{required:!0,message:"请输入申请原因",trigger:"blur"}],effectiveStartingTime:[{required:!0,message:"请选择时间",trigger:"change"}],effectiveEndingTime:[{required:!0,message:"请选择时间",trigger:"change"}]}}},methods:{removeItem:function(e){var t=this.objFormEmailSingle.items.indexOf(e);-1!==t&&this.objFormEmailSingle.items.splice(t,1)},addItem:function(){this.objFormEmailSingle.items.push({itemId:"",num:1})},handleChangeCascader:function(e){},submitForm:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return!1;var r=JSON.parse(JSON.stringify(t.objFormEmailSingle));t.$fetch.post(API.email.add_mail,r).then((function(a){var r=a.data;200==r.status?(t.$message.success(r.desc),t.$emit("changeTabS","list"),t.$refs[e].resetFields()):t.$message.error(r.desc)}))}))},fetchItemList:function(){var e=this;this.$fetch.post(API.email.item_list).then((function(t){var a=t.data;200==a.status?e.aItemList=a.data:e.$message.error(a.desc)}))},fetchServerList:function(){var e=this;this.$fetch.post(API.email.server_list).then((function(t){var a=t.data;200==a.status?e.aServerList=a.data:e.$message.error(a.desc)}))}},mounted:function(){this.fetchServerList(),this.fetchItemList()}},y=j,F=Object(m["a"])(y,E,S,!1,null,null,null),T=F.exports,_={name:"email",components:{listCon:u,multiCon:h,singleCon:T},data:function(){return{actTab:"single"}},methods:{handleGetAct:function(e){this.actTab=e}}},w=_,M=Object(m["a"])(w,r,l,!1,null,"bf25b8c4",null);t["default"]=M.exports},"5dbe":function(e,t,a){},f616:function(e,t,a){"use strict";var r=a("5dbe"),l=a.n(r);l.a}}]);
//# sourceMappingURL=chunk-7a6aa468.bf117c7f.js.map